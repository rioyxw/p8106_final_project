---
title: "models"
author: "Elaine Xu"
date: "5/2/2021"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(caret)
library(MASS)
library(mlbench)
library(pROC)
library(klaR)
library(dplyr)

knitr::opts_chunk$set(
  fig.width = 9,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## load data

```{r, message=FALSE, warning=FALSE}

student = read.table("./student-mat.csv", header = TRUE, sep = ";") %>%
  janitor::clean_names() %>%
  mutate(grade = round((g1+g2+g3)/3,2)) %>%
  dplyr::select(-g1,-g2,-g3) %>%
  mutate(school = as.numeric(as.factor(school)),
         sex = as.numeric(as.factor(sex)),
         address = as.numeric(as.factor(address)),
         famsize = as.numeric(as.factor(famsize)),
         pstatus = as.numeric(as.factor(pstatus)),
         mjob = as.numeric(as.factor(mjob)),
         fjob = as.numeric(as.factor(fjob)),
         reason = as.numeric(as.factor(reason)),
         guardian = as.numeric(as.factor(guardian)),
         schoolsup = as.numeric(as.factor(schoolsup)),
         famsup = as.numeric(as.factor(famsup)),
         paid = as.numeric(as.factor(paid)),
         activities = as.numeric(as.factor(activities)),
         nursery = as.numeric(as.factor(nursery)),
         higher = as.numeric(as.factor(higher)),
         internet = as.numeric(as.factor(internet)),
         romantic = as.numeric(as.factor(romantic)))

student$letter_grade[student$grade <=20 & student$grade>=10] <- "pass"
student$letter_grade[student$grade <10 & student$grade>=0] <- "nopass"

student_letter_grade <- student %>% dplyr::select(-grade) %>% mutate(letter_grade = as.factor(letter_grade))
```

```{r, include = FALSE}
# Set up train/test data for letter grade dataset

set.seed(1)

rowTrain = createDataPartition(student_letter_grade$letter_grade, p = 0.8, list = FALSE)

student_no_grade = model.matrix(letter_grade ~ ., student_letter_grade)[, -31]
x = student_no_grade[trainRows1, ]
y = student_letter_grade$letter_grade[trainRows1]
x_test = student_no_grade[-trainRows1, ]
y_test = student_letter_grade$letter_grade[-trainRows1]

```

## Models

```{r}
# LDA

lda.fit <- lda(letter_grade~., data = student_letter_grade,
               summaryFunction = twoClassSummary,
               subset = rowTrain)
#plot(lda.fit)

lda.fit$scaling

#mean(predict(lda.fit)$x)

ctrl <- trainControl(method = "repeatedcv", repeats = 5,
                     classProbs = TRUE)

set.seed(1)
model.lda <- train(x = student_letter_grade[rowTrain,1:30],
                   y = student_letter_grade$letter_grade[rowTrain],
                   method = "lda",
                   metric = "Accuracy",
                   trControl = ctrl)

#QDA
set.seed(1)
model.qda <- train(x = student_letter_grade[rowTrain,1:30],
                   y = student_letter_grade$letter_grade[rowTrain],
                   method = "qda",
                   metric = "Accuracy",
                   trControl = ctrl)

#NB
#set.seed(1)

#nbGrid <- expand.grid(usekernel = c(FALSE,TRUE),
#                      fL = 1, 
#                      adjust = seq(.2, 3, by = .2))

#model.nb <- train(x = student_letter_grade[rowTrain,1:30],
#                  y = student_letter_grade$letter_grade[rowTrain],
#                  method = "nb",
#                  tuneGrid = nbGrid,
#                  metric = "Accuracy",
#                  trControl = ctrl)
```

