---
title: "models"
author: "Elaine Xu"
date: "5/2/2021"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(caret)
library(MASS)
library(mlbench)
library(pROC)
library(klaR)
library(dplyr)

knitr::opts_chunk$set(
  fig.width = 9,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## load data

```{r, message=FALSE, warning=FALSE}

student_df = read.table("./student-mat.csv", header = TRUE, sep = ";") %>%
  janitor::clean_names() %>%
  mutate(grade = round((g1+g2+g3)/3,2),
        letter_grade = case_when(grade >= 10 ~ "pass",
                                 grade < 10 ~ "fail")) %>%
  dplyr::select(-g1,-g2,-g3,-grade) %>%
  mutate_if(is.character, as.factor)
```

```{r, include = FALSE}
# Set up train/test data for letter grade dataset

set.seed(1)

rowTrain = createDataPartition(student_df$letter_grade, p = 0.8, list = FALSE)

student_no_grade = model.matrix(letter_grade ~ ., student_df)[, -31]
x = student_no_grade[rowTrain, ]
y = student_df$letter_grade[rowTrain]
x_test = student_no_grade[-rowTrain, ]
y_test = student_df$letter_grade[-rowTrain]

ctrl <- trainControl(method = "repeatedcv", repeats = 5,
                     summaryFunction = twoClassSummary, 
                     classProbs = TRUE)
```

## Models

```{r}
# LDA

lda.fit <- lda(letter_grade~., data = student_letter_grade,
               summaryFunction = twoClassSummary,
               subset = rowTrain)
#plot(lda.fit)

lda.fit$scaling

#mean(predict(lda.fit)$x)



set.seed(1)
model.lda <- train(x = student_letter_grade[rowTrain,1:30],
                   y = student_letter_grade$letter_grade[rowTrain],
                   method = "lda",
                   metric = "Accuracy",
                   trControl = ctrl)

#QDA
set.seed(1)
model.qda <- train(x = student_letter_grade[rowTrain,1:30],
                   y = student_letter_grade$letter_grade[rowTrain],
                   method = "qda",
                   metric = "Accuracy",
                   trControl = ctrl)

#NB
#set.seed(1)

#nbGrid <- expand.grid(usekernel = c(FALSE,TRUE),
#                      fL = 1, 
#                      adjust = seq(.2, 3, by = .2))

#model.nb <- train(x = student_letter_grade[rowTrain,1:30],
#                  y = student_letter_grade$letter_grade[rowTrain],
#                  method = "nb",
#                  tuneGrid = nbGrid,
#                  metric = "Accuracy",
#                  trControl = ctrl)
```

