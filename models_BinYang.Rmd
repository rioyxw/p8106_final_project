---
title: "Models"
author: Bin Yang
output:
  pdf_document:
    toc: yes
    toc_depth: 2
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '2'
header-includes:
- \usepackage{fancyhdr}
- \usepackage{lipsum}
- \pagestyle{fancy}
- \fancyhead[R]{\thepage}
- \fancypagestyle{plain}{\pagestyle{fancy}}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(tidyverse)
library(caret)
library(rpart)
library(rpart.plot)
library(party)
library(partykit)
library(randomForest)
library(ranger)
library(gbm)
```

```{r read in data set}
# student = read.table("./student-mat.csv", header = TRUE, sep = ";") %>%
#   janitor::clean_names() %>%
#   mutate(grade = round((g1+g2+g3)/3,2),
#          letter_grade = case_when(grade >= 10 ~ "pass",
#                                   grade < 10 ~ "fail")) %>%
#   select(-g1,-g2,-g3,-grade) %>%
#   mutate_if(is.character, as.factor)
```

#### Classification trees   
```{r classification tree: CART}
set.seed(1)  

rpart.fit = train(letter_grade ~ .,
                  student_df,
                  subset = rowTrain,
                  method = "rpart",
                  tuneGrid = data.frame(cp = exp(seq(-5, -2, len = 50))),
                  trControl = ctrl,
                  metric  = "ROC")
ggplot(rpart.fit, highlight = TRUE)

# rpart.plot(rpart.fit$finalModel)
# Best tuning parameter:  
rpart.fit$bestTune
```

```{r classification tree: CIT}  
set.seed(1)  

ctree.fit = train(letter_grade ~ .,
                  student_df,
                  subset = rowTrain,
                  method = "ctree",
                  tuneGrid = data.frame(mincriterion = 1 - exp(seq(-2, -1, length =50))),
                  metric = "ROC",
                  trControl = ctrl) 
ggplot(ctree.fit, highlight = TRUE)

# plot(ctree.fit$finalModel)
# Best tuning parameter:  
ctree.fit$bestTune
```

